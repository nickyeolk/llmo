<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM Brand Ranker Pro</title>
    <style>
        body { font-family: system-ui, -apple-system, sans-serif; max-width: 900px; margin: 4rem auto; padding: 0 1rem; background: #f4f4f5; color: #18181b; }
        .card { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border: 1px solid #e4e4e7;}
        h1 { margin-top: 0; margin-bottom: 0.5rem; }
        .subtitle { color: #71717a; margin-bottom: 2rem; margin-top: 0;}
        
        .input-row {
            display: flex;
            gap: 1rem;
            align-items: flex-end;
            margin-bottom: 2rem;
        }
        
        .input-group { flex: 1; }

        label { display: block; margin-bottom: 0.5rem; font-weight: 600; color: #3f3f46; font-size: 0.9rem;}
        input { width: 100%; padding: 0.75rem; border: 1px solid #d4d4d8; border-radius: 6px; box-sizing: border-box; font-size: 1rem;}
        
        button { 
            padding: 0.75rem 1.5rem; 
            background: #2563eb; 
            color: white; 
            border: none; 
            border-radius: 6px; 
            font-weight: 700; 
            font-size: 1rem; 
            cursor: pointer; 
            transition: background 0.2s; 
            height: 46px; 
            white-space: nowrap;
        }
        button:hover { background: #1d4ed8; }
        button:disabled { background: #93c5fd; cursor: not-allowed; }
        
        #results { margin-top: 2rem; display: flex; flex-direction: column; gap: 1rem; }
        
        /* Model Blocks */
        .model-details { background: white; border: 2px solid #e4e4e7; border-radius: 8px; overflow: hidden; }
        
        .model-summary { 
            background: #fafafa; 
            padding: 1rem; 
            font-weight: 700; 
            font-size: 1.1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .model-header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            padding-right: 1rem;
        }

        .overall-score {
            font-size: 0.9rem;
            background: #18181b;
            color: white;
            padding: 0.35rem 0.75rem;
            border-radius: 6px;
            font-weight: 600;
        }
        
        .dimensions-container { padding: 1rem; display: flex; flex-direction: column; gap: 0.5rem; background: #fff;}

        /* Dimension Items */
        .dim-details { border: 1px solid #e4e4e7; border-radius: 6px; }
        .dim-summary { padding: 0.75rem; font-size: 0.95rem; color: #3f3f46; background: #f8fafc;}
        .dim-summary:hover { background: #f1f5f9; }

        summary { display: flex; cursor: pointer; list-style: none; }
        summary::after { content: "‚ñº"; font-size: 0.8rem; color: #a1a1aa; transition: transform 0.2s; margin-left: 10px;}
        details[open] summary::after { transform: rotate(180deg); }

        .raw-text { padding: 1rem; background: #f1f5f9; border-top: 1px solid #e4e4e7; font-size: 0.9rem; color: #475569; font-family: monospace; white-space: pre-wrap; }

        .rank-badge { background: #e0f2fe; color: #0369a1; padding: 0.25rem 0.75rem; border-radius: 999px; font-weight: 700; font-size: 0.875rem; }
        .rank-badge.not-found { background: #f3f4f6; color: #64748b; font-weight: 500;}
        .rank-badge.error { background: #fee2e2; color: #991b1b; }
        
        @media (max-width: 600px) {
            .input-row { flex-direction: column; align-items: stretch; gap: 1rem;}
        }
    </style>
</head>
<body>
    <div class="card">
        <h1>üèÜ LLMO Ranker Pro</h1>
        <p class="subtitle">Multi-dimensional AI brand analysis across 6 top models.</p>
        
        <div class="input-row">
            <div class="input-group">
                <label for="company">Company Name</label>
                <input type="text" id="company" placeholder="Patagonia">
            </div>
            
            <div class="input-group">
                <label for="industry">Industry</label>
                <input type="text" id="industry" placeholder="Outdoor Apparel">
            </div>
            
            <button onclick="getRankings()" id="btn">Analyze</button>
        </div>
        
        <div id="results"></div>
    </div>

    <script>
        async function getRankings() {
            const btn = document.getElementById('btn');
            const resDiv = document.getElementById('results');
            
            // --- NEW DEFAULT LOGIC ---
            const compInput = document.getElementById('company');
            const indInput = document.getElementById('industry');

            // If empty, grab the placeholder text
            const company = compInput.value.trim() || compInput.getAttribute('placeholder');
            const industry = indInput.value.trim() || indInput.getAttribute('placeholder');

            // Visually update the inputs so the user sees what's happening
            if (!compInput.value) compInput.value = company;
            if (!indInput.value) indInput.value = industry;
            // -------------------------

            btn.innerText = "Running...";
            btn.disabled = true;
            
            resDiv.innerHTML = `
                <div style='text-align:center; color:#666; padding: 2rem;'>
                    <p><strong>Phase 1:</strong> Identifying 5 key ${industry} dimensions...</p>
                    <p><strong>Phase 2:</strong> Scanning 6 AI models (30 concurrent queries)...</p>
                    <div style="margin-top:1rem; height:4px; background:#e4e4e7; border-radius:2px; overflow:hidden;">
                        <div style="height:100%; background:#2563eb; width:50%; animation: load 2s infinite;"></div>
                    </div>
                </div>`;

            try {
                const response = await fetch('/api/rank', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ company, industry })
                });
                
                const data = await response.json();

                if (data.error) throw new Error(data.error);
                
                let html = "";
                const dimensionsList = data.dimensions;
                const modelResults = data.modelResults;

                for (const [modelName, dimensionResults] of Object.entries(modelResults)) {
                    const shortModelName = modelName.split('/')[1] || modelName;
                    
                    let dimensionsHtml = "";
                    let totalRankScore = 0;
                    let validRankCount = 0;

                    dimensionsList.forEach(dim => {
                        const result = dimensionResults[dim] || { rank: "Error", raw: "Failed" };

                        let badgeClass = "rank-badge";
                        let rankVal = 6; 

                        if (result.rank.includes("Error")) {
                            badgeClass += " error";
                            rankVal = null;
                        } else if (result.rank.startsWith("#")) {
                            rankVal = parseInt(result.rank.substring(1));
                        } else {
                            badgeClass += " not-found";
                            rankVal = 6; 
                        }

                        if (rankVal !== null) {
                            totalRankScore += rankVal;
                            validRankCount++;
                        }
                        
                        dimensionsHtml += `
                            <details class="dim-details">
                                <summary class="dim-summary">
                                    <span>${dim}</span>
                                    <span class="${badgeClass}">${result.rank}</span>
                                </summary>
                                <div class="raw-text"><strong>Raw AI Output:</strong><br>${result.raw}</div>
                            </details>
                        `;
                    });

                    let overallText = "N/A";
                    if (validRankCount > 0) {
                        const avg = (totalRankScore / validRankCount).toFixed(1);
                        overallText = `Avg Rank: ${avg}`;
                    }

                    html += `
                        <details class="model-details" open>
                            <summary class="model-summary">
                                <div class="model-header-content">
                                    <span>ü§ñ ${shortModelName}</span>
                                    <span class="overall-score">${overallText}</span>
                                </div>
                            </summary>
                            <div class="dimensions-container">
                                ${dimensionsHtml}
                            </div>
                        </details>`;
                }
                resDiv.innerHTML = html;

            } catch (e) {
                resDiv.innerHTML = `<div style="padding:2rem; text-align:center; color:#ef4444; background:#fef2f2; border-radius:8px;"><strong>Error:</strong> ${e.message}</div>`;
            } finally {
                btn.innerText = "Analyze";
                btn.disabled = false;
            }
        }
    </script>
    <style>
        @keyframes load { 0% { transform: translateX(-100%); } 100% { transform: translateX(200%); } }
    </style>
</body>
</html>